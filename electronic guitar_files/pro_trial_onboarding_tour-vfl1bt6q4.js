// Generated by CoffeeScript 1.7.1
var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

define(['jquery', 'modules/clean/ajax', 'modules/clean/dbmodal', 'modules/clean/dbmodal_loading'], function($j, ajax, dbmodal, DBModalLoading) {
  var DBModal, DBModalStack, ProTrialOnboardingTour, ProTrialOnboardingTourHeaderLink;
  DBModal = dbmodal.DBModal;
  DBModalStack = dbmodal.DBModalStack;
  ProTrialOnboardingTour = (function(_super) {
    __extends(ProTrialOnboardingTour, _super);

    function ProTrialOnboardingTour(options) {
      this.options = options;
      this._log = __bind(this._log, this);
      this._redraw = __bind(this._redraw, this);
      this._log_and_show_current_step = __bind(this._log_and_show_current_step, this);
      this._finish_tour = __bind(this._finish_tour, this);
      this._advance_tour = __bind(this._advance_tour, this);
      this._go_back_tour = __bind(this._go_back_tour, this);
      this._hide = __bind(this._hide, this);
      this._show = __bind(this._show, this);
      ProTrialOnboardingTour.__super__.constructor.call(this, this.options);
      this.vertical_offset = 200;
    }

    ProTrialOnboardingTour.show = function(trigger) {
      var modal;
      modal = new this({
        element_id: 'pro-trial-onboarding-tour',
        click_out_to_close: false,
        vars: {
          trigger: trigger
        }
      });
      return modal.show();
    };

    ProTrialOnboardingTour.prototype._show = function() {
      ProTrialOnboardingTour.__super__._show.apply(this, arguments);
      this._listen();
      this._current_step = 0;
      return this._log_and_show_current_step(this.vars.trigger);
    };

    ProTrialOnboardingTour.prototype._hide = function() {
      ProTrialOnboardingTour.__super__._hide.apply(this, arguments);
      this._unlisten();
      return $j('#pro-trial-tour-header-bubble').removeClass('force-hidden');
    };

    ProTrialOnboardingTour.prototype._listen = function() {
      $j(document).on('click', '.prev-step', this._go_back_tour);
      $j(document).on('click', 'button.next-step', this._advance_tour);
      return $j(document).on('click', 'button.finish-tour', this._finish_tour);
    };

    ProTrialOnboardingTour.prototype._unlisten = function() {
      $j(document).off('click', '.prev-step', this._go_back_tour);
      $j(document).off('click', 'button.next-step', this._advance_tour);
      return $j(document).on('click', 'button.finish-tour', this._finish_tour);
    };

    ProTrialOnboardingTour.prototype._go_back_tour = function(e) {
      e.preventDefault();
      this._current_step -= 1;
      return this._log_and_show_current_step();
    };

    ProTrialOnboardingTour.prototype._advance_tour = function(e) {
      e.preventDefault();
      this._current_step += 1;
      return this._log_and_show_current_step();
    };

    ProTrialOnboardingTour.prototype._finish_tour = function() {
      this._log('finish_trial_onboarding');
      return this.hide();
    };

    ProTrialOnboardingTour.prototype._log_and_show_current_step = function(trigger) {
      var extra_data;
      extra_data = trigger ? {
        'trigger': trigger
      } : {};
      this._log('view_trial_onboarding_' + this._current_step, extra_data);
      return this._redraw();
    };

    ProTrialOnboardingTour.prototype._redraw = function() {
      var step_number, x_button;
      this.$modal_window.find('.welcome, .tour-feature').hide();
      x_button = this.$modal_window.find('.db-modal-x');
      if (this._current_step === 0) {
        this.$modal_window.find('.welcome').show();
        return x_button.hide();
      } else {
        step_number = this._current_step;
        this.$modal_window.find(".tour-feature[data-step-num=\"" + step_number + "\"]").show();
        return x_button.show();
      }
    };

    ProTrialOnboardingTour.prototype._log = function(evt, extra_data) {
      return ajax.WebRequest({
        url: "/pro/trial_onboarding_tour_log",
        data: {
          evt: evt,
          extra_data: JSON.stringify(extra_data)
        }
      });
    };

    return ProTrialOnboardingTour;

  })(DBModal);
  ProTrialOnboardingTourHeaderLink = (function() {
    function ProTrialOnboardingTourHeaderLink($container) {
      this.$container = $container;
      this._listen();
    }

    ProTrialOnboardingTourHeaderLink.prototype._listen = function() {
      return this.$container.find('.start-tour').on('click', (function(_this) {
        return function(e) {
          e.preventDefault();
          return ProTrialOnboardingTour.show('restart_tour');
        };
      })(this));
    };

    return ProTrialOnboardingTourHeaderLink;

  })();
  return {
    ProTrialOnboardingTour: ProTrialOnboardingTour,
    ProTrialOnboardingTourHeaderLink: ProTrialOnboardingTourHeaderLink
  };
});

//# sourceMappingURL=pro_trial_onboarding_tour.map
