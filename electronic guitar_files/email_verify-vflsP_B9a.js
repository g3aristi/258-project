// Generated by CoffeeScript 1.7.1
define(['jquery', 'modules/clean/ajax'], function($j, ajax) {
  var EmailVerify;
  EmailVerify = {
    _POLLING: {},
    send_verification_email: function(user, email, reason, on_send) {
      return ajax.WebRequest({
        url: '/sendverifyemail',
        data: {
          email: email,
          reason: reason
        },
        success: function() {
          return on_send();
        },
        subject_user: user
      });
    },
    check_verification: function(user, email, onsuccess, onfailure) {
      return ajax.AuthenticatedRequest({
        url: '/isemailverified',
        data: {
          email: email
        },
        success: function(data) {
          if (data === 'ok') {
            return onsuccess();
          } else {
            return onfailure();
          }
        },
        subject_user: user
      });
    },
    listen_for_verification: function(user, email, on_verify) {
      var poll_key;
      poll_key = "" + user.id + ":" + email;
      if (this._POLLING[poll_key]) {
        return;
      }
      this._POLLING[poll_key] = true;
      return this._poll_for_verification(user, email, on_verify);
    },
    _poll_for_verification: function(user, email, onverify) {
      var POLL_INTERVAL;
      POLL_INTERVAL = 4000;
      return this.check_verification(user, email, onverify, (function(_this) {
        return function() {
          return setTimeout(function() {
            return _this._poll_for_verification(user, email, onverify);
          }, POLL_INTERVAL);
        };
      })(this));
    }
  };
  window.EmailVerify = EmailVerify;
  return EmailVerify;
});

//# sourceMappingURL=email_verify.map
