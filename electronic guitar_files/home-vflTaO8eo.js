// Generated by CoffeeScript 1.7.1
define(['jquery', 'dropbox', 'modules/clean/analytics', 'modules/clean/upsell/ha_loader', 'modules/clean/payments/pro_trial_onboarding_tour', 'modules/clean/teams/trial_buy_now', 'modules/dirty/sharing/sharing_growth_email_experiments'], function($j, dropbox, analytics, HALoader, pro_trial_onboarding_tour, dfb_trial_buy_now, SharingGrowthEmailExperiments) {
  var HomePageController;
  HomePageController = {
    init: function(opts) {
      var client_download, extra, show_upload_modal, user;
      HALoader.init('home', Browse.active_user, opts.force_campaign_id);
      if (opts.show_email_just_verified) {
        return EmailVerification.getForRole(opts.role).show_verified_modal();
      } else if (opts.show_email_just_verified_and_changed) {
        return EmailVerification.getForRole(opts.role).show_verified_and_changed_modal();
      } else if (opts.show_sent_verification_email) {
        return EmailVerification.getForRole(opts.role).show_sent_modal();
      } else if (opts.show_upload) {
        show_upload_modal = function() {
          var extra;
          if (opts.email_src) {
            extra = {
              ns_id: Browse.containing_ns_id(),
              email_src: opts.email_src
            };
            analytics.SharedFolderActivityLogger.log("web", "show_upload_modal_for_sf_from_email", Browse.active_user, extra);
            SharingGrowthEmailExperiments.listen_for_first_upload(Browse.active_user, extra);
          }
          return FileOps.show_upload.bind(FileOps)();
        };
        return HomePageController._call_when_browse_ready(show_upload_modal);
      } else if (opts.show_share_existing_modal) {
        if (opts.email_src) {
          extra = {
            email_src: opts.email_src
          };
          analytics.SharedFolderActivityLogger.log("web", "show_share_existing_folder_modal_from_email", Browse.active_user, extra);
        }
        return SharingModals.show_share_existing_modal(opts.fq_path, Browse.active_user);
      } else if (opts.show_share_options && !opts.share_subfolder) {
        user = Viewer.get_viewer().get_user_by_role(opts.role);
        if (!user) {
          user = Viewer.get_viewer().get_users()[0];
        }
        return SharingModals.show_shared_folder_options_modal(opts.fq_path, user);
      } else if (opts.show_share_options && opts.share_subfolder) {
        user = Viewer.get_viewer().get_user_by_role(opts.role);
        if (!user) {
          user = Viewer.get_viewer().get_users()[0];
        }
        return SharingModals.show_shared_subfolder_modal(opts.fq_path, user);
      } else if (opts.show_download_modal) {
        client_download = new ClientDownload();
        return client_download.show_download_modal();
      } else if (opts.show_pro_trial_modal) {
        return pro_trial_onboarding_tour.ProTrialOnboardingTour.show('trial_start');
      } else if (opts.remaining_trial_days) {
        return dfb_trial_buy_now.showModal(opts.remaining_trial_days);
      } else if (opts.show_upsell_modal) {
        return $j('#db-modal-upsell-home-modal').addClass('show-upsell-modal').trigger('show-upsell-modal');
      }
    },
    _call_when_browse_ready: function(callback) {
      var do_callback;
      if (Browse.first_load) {
        do_callback = function(e) {
          document.stopObserving(Browse.UPDATE_EVT, do_callback);
          return callback();
        };
        return document.observe(Browse.UPDATE_EVT, do_callback);
      } else {
        return callback();
      }
    }
  };
  return HomePageController;
});

//# sourceMappingURL=home.map
