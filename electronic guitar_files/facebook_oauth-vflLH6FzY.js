// Generated by CoffeeScript 1.7.1
define(['jquery', 'modules/core/uri', 'modules/clean/ajax', 'modules/clean/viewer'], function($j, URI, ajax, Viewer) {
  var FacebookOAuth;
  FacebookOAuth = {
    do_auth: function(callback, user_id) {
      var popup_uri;
      assert(user_id != null, "user_id must be specified");
      popup_uri = window.open(URI({
        path: "/fb/access_token"
      }).updateQuery(Constants.UID_PARAM_NAME, user_id).toString(), "fb_auth", "width=600,height=450");
      if (callback) {
        return FacebookOAuth.onLoginSuccessCallback = callback;
      }
    },
    post: function(message, link, link_name, description, picture, failure_callback, user_id) {
      assert(user_id != null, "user_id must be specified!");
      if (!Viewer.get_viewer().is_signed_in) {
        window.open(URI.parse('http://www.facebook.com/sharer.php').setQuery({
          u: link,
          t: link_name
        }).toString());
        return;
      }
      if (typeof FacebookOAuth.custom_show_posting === "function") {
        FacebookOAuth.custom_show_posting();
      }
      return new ajax.WebRequest({
        url: '/fb/post',
        data: {
          message: message,
          link: link,
          link_name: link_name,
          description: description,
          from_referrals: FacebookOAuth.from_referrals,
          from_getspace: FacebookOAuth.from_getspace,
          picture: (picture ? picture : "")
        },
        success: function(data, status, xhr) {
          var response_text;
          response_text = xhr.responseText;
          if (response_text.indexOf("ok") === 0) {
            return typeof FacebookOAuth.custom_show_complete === "function" ? FacebookOAuth.custom_show_complete() : void 0;
          } else if (response_text.indexOf("auth") === 0) {
            return FacebookOAuth.do_auth(function() {
              return FacebookOAuth.post(message, link, link_name, description, picture, failure_callback, user_id);
            }, user_id);
          }
        },
        error: function() {
          return typeof failure_callback === "function" ? failure_callback() : void 0;
        },
        subject_user: user_id
      });
    }
  };
  window.FacebookOAuth = FacebookOAuth;
  return FacebookOAuth;
});

//# sourceMappingURL=facebook_oauth.map
